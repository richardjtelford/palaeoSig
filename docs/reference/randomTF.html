<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Proportion of variance in the fossil data explained by an environmental reconstruction — randomTF • palaeoSig</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Proportion of variance in the fossil data explained by an environmental reconstruction — randomTF"><meta name="description" content="Calculate the proportion of variance in the fossil data
explained by an environmental reconstruction with a constrained ordination.
This value is compared with a null distribution calculated as the proportion
of variance in the fossil data explained by reconstructions from transfer
functions trained on random data."><meta property="og:description" content="Calculate the proportion of variance in the fossil data
explained by an environmental reconstruction with a constrained ordination.
This value is compared with a null distribution calculated as the proportion
of variance in the fossil data explained by reconstructions from transfer
functions trained on random data."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">palaeoSig</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1-4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/h-block-crossvalidation.html">H-block cross-validation</a></li>
    <li><a class="dropdown-item" href="../articles/randomTF-spatial.html">randomTF on spatially structured environments</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/richardjtelford/palaeoSig/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Proportion of variance in the fossil data explained by an environmental reconstruction</h1>
      <small class="dont-index">Source: <a href="https://github.com/richardjtelford/palaeoSig/blob/HEAD/R/1_randomTF.R" class="external-link"><code>R/1_randomTF.R</code></a>, <a href="https://github.com/richardjtelford/palaeoSig/blob/HEAD/R/plot.palaeoSig.R" class="external-link"><code>R/plot.palaeoSig.R</code></a></small>
      <div class="d-none name"><code>randomTF.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate the proportion of variance in the fossil data
explained by an environmental reconstruction with a constrained ordination.
This value is compared with a null distribution calculated as the proportion
of variance in the fossil data explained by reconstructions from transfer
functions trained on random data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">randomTF</span><span class="op">(</span></span>
<span>  <span class="va">spp</span>,</span>
<span>  <span class="va">env</span>,</span>
<span>  <span class="va">fos</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">99</span>,</span>
<span>  <span class="va">fun</span>,</span>
<span>  <span class="va">col</span>,</span>
<span>  condition <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">autosim</span>,</span>
<span>  ord <span class="op">=</span> <span class="va">rda</span>,</span>
<span>  permute <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">models</span>,</span>
<span>  make_models <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'palaeoSig'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">variable_names</span>, top <span class="op">=</span> <span class="fl">0.7</span>, adj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, p_val <span class="op">=</span> <span class="fl">0.05</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'palaeoSig'</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">variable_names</span>, nbins <span class="op">=</span> <span class="fl">20</span>, top <span class="op">=</span> <span class="fl">0.7</span>, p_val <span class="op">=</span> <span class="fl">0.05</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-spp">spp<a class="anchor" aria-label="anchor" href="#arg-spp"></a></dt>
<dd><p>Data frame of modern training set species data, transformed as
required for example with <code>sqrt</code></p></dd>


<dt id="arg-env">env<a class="anchor" aria-label="anchor" href="#arg-env"></a></dt>
<dd><p>Data frame of training set environmental variables or vector with
single environmental variable</p></dd>


<dt id="arg-fos">fos<a class="anchor" aria-label="anchor" href="#arg-fos"></a></dt>
<dd><p>Data frame of fossil species data, with same species codes and
transformations as <code>spp</code></p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>number of random training sets. More is better.</p></dd>


<dt id="arg-fun">fun<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>Transfer function method.
Additional arguments to <code>fun</code> can be passed with <code>...</code></p></dd>


<dt id="arg-col">col<a class="anchor" aria-label="anchor" href="#arg-col"></a></dt>
<dd><p>Some transfer functions return more than one column of results,
for example with different <code><a href="https://rdrr.io/pkg/rioja/man/WAPLS.html" class="external-link">WAPLS</a></code> components.
<code>col</code> selects which column of the reconstructions to use.
See the relevant transfer function method help file.</p></dd>


<dt id="arg-condition">condition<a class="anchor" aria-label="anchor" href="#arg-condition"></a></dt>
<dd><p>Optional data frame of reconstructions to partial out when
testing if multiple independent reconstructions are possible.</p></dd>


<dt id="arg-autosim">autosim<a class="anchor" aria-label="anchor" href="#arg-autosim"></a></dt>
<dd><p>Optional data frame of random values.
This is useful if the training set is spatially autocorrelated and the
supplied data frame contains autocorrelated random variables.
If <code>autosim</code> is missing, and <code>permute</code> is <code>FALSE</code>, the
transfer functions are trained on random variables drawn from a uniform
distribution.</p></dd>


<dt id="arg-ord">ord<a class="anchor" aria-label="anchor" href="#arg-ord"></a></dt>
<dd><p>Constrained ordination method to use. <code><a href="https://rdrr.io/pkg/vegan/man/cca.html" class="external-link">rda</a></code> is
the default, <code><a href="https://rdrr.io/pkg/vegan/man/cca.html" class="external-link">cca</a></code> should also work.
<code><a href="https://rdrr.io/pkg/vegan/man/dbrda.html" class="external-link">capscale</a></code> won't work without modifications to the code
(or a wrapper).</p></dd>


<dt id="arg-permute">permute<a class="anchor" aria-label="anchor" href="#arg-permute"></a></dt>
<dd><p>logical value. Generate random environmental variables by
permuting existing variable. Only possible if there is only one environmental
variable and <code>autosim</code> is missing.</p></dd>


<dt id="arg-models">models<a class="anchor" aria-label="anchor" href="#arg-models"></a></dt>
<dd><p>list of models made by <code>randomTF</code> with argument
<code>make_models = TRUE</code></p></dd>


<dt id="arg-make-models">make_models<a class="anchor" aria-label="anchor" href="#arg-make-models"></a></dt>
<dd><p>logical, should a list of transfer functions trained on
random data be returned</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other arguments to the transfer function. For example to change
the distance metric in <code><a href="https://rdrr.io/pkg/rioja/man/MAT.html" class="external-link">MAT</a></code>.
Also extra arguments to plot.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Output from randomTF</p></dd>


<dt id="arg-variable-names">variable_names<a class="anchor" aria-label="anchor" href="#arg-variable-names"></a></dt>
<dd><p>Names of environmental variables. If missing, taken
from <code>env</code> data.frame.</p></dd>


<dt id="arg-top">top<a class="anchor" aria-label="anchor" href="#arg-top"></a></dt>
<dd><p>Proportion of the figure below the environmental name labels.</p></dd>


<dt id="arg-adj">adj<a class="anchor" aria-label="anchor" href="#arg-adj"></a></dt>
<dd><p>Adjust the position that the environmental names are plotted at.</p></dd>


<dt id="arg-p-val">p_val<a class="anchor" aria-label="anchor" href="#arg-p-val"></a></dt>
<dd><p>P value to draw a line vertical line at (with which=2)</p></dd>


<dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>Output from randomTF</p></dd>


<dt id="arg-nbins">nbins<a class="anchor" aria-label="anchor" href="#arg-nbins"></a></dt>
<dd><p>integer giving number of bins for the histogram</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with components</p>
<dl><dt>PCA</dt>
<dd><p>The unconstrained ordination of the fossil data.</p></dd>

<dt>preds</dt>
<dd><p>A list of the containing the reconstructions for each
environmental variable.</p></dd>

<dt>MAX</dt>
<dd><p>Proportion of the variance explained by the first axis of the
unconstrained ordination.
This is the maximum amount that a reconstruction of a single variable can
explain.</p></dd>

<dt>EX</dt>
<dd><p>The proportion of the variance in the fossil data explained by
each reconstruction.</p></dd>

<dt>sim.ex</dt>
<dd><p>The proportion of variance explained by each of the random
environmental variables.</p></dd>

<dt>sig</dt>
<dd><p>The p-value of each reconstruction.</p></dd>


</dl><p>If <code>make_models = TRUE</code>, a list of transfer function models is returned.</p>
<p><code>autoplot.palaeoSig</code> returns a <code>ggplot2</code> object</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function calculates the proportion of variance in the fossil
data explained by the transfer function reconstruction.
This is compared with a null distribution of the proportion of variance
explained by reconstructions based on random environmental variables.
Reconstructions can be partialled out to test if multiple reconstructions are
statistically significant. If the environment is spatially autocorrelated, a
red-noise null should be used instead of the default white noise null.
Red noise environmental variables can be generated with the <span class="pkg">gstat</span>
package.</p>
<p>Any transfer function in the <span class="pkg">rioja</span> package can be used. Other methods
(e.g. random forests) can be used by making a wrapper function.</p>
<p>If reconstructions from several sites are to be tested using the same
training set it can be much faster to train the models on random
environmental data once and then use them repeatedly.
This can be done with <code>make_models = TRUE</code> and then running
<code>randomTF</code> again giving the resultant models to the <code>models</code>
argument.
<code>make_models</code> does not work with MAT.</p>
<p>For some transfer function methods, including <code>WA</code>, the code can be made
somewhat faster by coercing the modern and fossil species data to matrices
(<code>spp &lt;- as.matrix(spp)</code>), otherwise <code>WA</code> has to do this repeatedly.
With <code>MAT</code>, this should not be done as it might cause an error.</p>
    </div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>

<ul><li><p><code>plot(palaeoSig)</code>: Plot palaeoSig object</p></li>
<li><p><code>autoplot(palaeoSig)</code>: autoplot function for palaeoSig object</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>If there are only a few fossil levels, <code><a href="obs.cor.html">obs.cor</a></code> might have
more power.
If there are few taxa, tests on <code><a href="https://rdrr.io/pkg/rioja/man/MAT.html" class="external-link">MAT</a></code> reconstructions have
more statistical power than those based on <code><a href="https://rdrr.io/pkg/rioja/man/WA.html" class="external-link">WA</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Telford, R. J. and Birks, H. J. B. (2011) A novel method for
assessing the statistical significance of quantitative reconstructions
inferred from biotic assemblages. <em>Quaternary Science Reviews</em>
<b>30</b>: 1272–1278.
<a href="https://doi.org/10.1016/j.quascirev.2011.03.002" class="external-link">doi:10.1016/j.quascirev.2011.03.002</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="obs.cor.html">obs.cor</a></code>, <code><a href="https://rdrr.io/pkg/rioja/man/WA.html" class="external-link">WA</a></code>,
<code><a href="https://rdrr.io/pkg/rioja/man/MAT.html" class="external-link">MAT</a></code>, <code><a href="https://rdrr.io/pkg/rioja/man/WAPLS.html" class="external-link">WAPLS</a></code>,
<code><a href="https://rdrr.io/pkg/vegan/man/cca.html" class="external-link">rda</a></code>, <code><a href="https://rdrr.io/pkg/vegan/man/cca.html" class="external-link">cca</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Richard Telford <a href="mailto:richard.telford@uib.no">richard.telford@uib.no</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://www.staff.ncl.ac.uk/stephen.juggins/" class="external-link">rioja</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">SWAP</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">RLGH</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rlghr</span> <span class="op">&lt;-</span> <span class="fu">randomTF</span><span class="op">(</span></span></span>
<span class="r-in"><span>  spp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">SWAP</span><span class="op">$</span><span class="va">spec</span><span class="op">)</span>, env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pH <span class="op">=</span> <span class="va">SWAP</span><span class="op">$</span><span class="va">pH</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  fos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">RLGH</span><span class="op">$</span><span class="va">spec</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">49</span>, fun <span class="op">=</span> <span class="va">WA</span>, col <span class="op">=</span> <span class="st">"WA.inv"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rlghr</span><span class="op">$</span><span class="va">sig</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pH </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.04 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rlghr</span>, <span class="st">"pH"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="randomTF-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">rlghr</span>, <span class="st">"pH"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="randomTF-2.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Richard Telford.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

