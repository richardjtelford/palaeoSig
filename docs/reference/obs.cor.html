<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Weighted correlation between weighted averaging optima and constrained ordination species scores. — obs.cor • palaeoSig</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Weighted correlation between weighted averaging optima and constrained ordination species scores. — obs.cor"><meta name="description" content="obs.cor calculates the weighted correlation between the species
weighted average optima and the axis one species scores of an ordination
constrained by the WA reconstruction."><meta property="og:description" content="obs.cor calculates the weighted correlation between the species
weighted average optima and the axis one species scores of an ordination
constrained by the WA reconstruction."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">palaeoSig</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1-4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/h-block-crossvalidation.html">H-block cross-validation</a></li>
    <li><a class="dropdown-item" href="../articles/randomTF-spatial.html">randomTF on spatially structured environments</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/richardjtelford/palaeoSig/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Weighted correlation between weighted averaging optima and constrained ordination species scores.</h1>
      <small class="dont-index">Source: <a href="https://github.com/richardjtelford/palaeoSig/blob/HEAD/R/obs.cor.R" class="external-link"><code>R/obs.cor.R</code></a>, <a href="https://github.com/richardjtelford/palaeoSig/blob/HEAD/R/plot.obscor.R" class="external-link"><code>R/plot.obscor.R</code></a></small>
      <div class="d-none name"><code>obs.cor.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>obs.cor calculates the weighted correlation between the species
weighted average optima and the axis one species scores of an ordination
constrained by the WA reconstruction.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">obs.cor</span><span class="op">(</span></span>
<span>  <span class="va">spp</span>,</span>
<span>  <span class="va">env</span>,</span>
<span>  <span class="va">fos</span>,</span>
<span>  ord <span class="op">=</span> <span class="va">rda</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">99</span>,</span>
<span>  min.occur <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">autosim</span>,</span>
<span>  permute <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'obscor'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">xlab</span>,</span>
<span>  <span class="va">ylab</span>,</span>
<span>  f <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  which <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  variable_names <span class="op">=</span> <span class="st">"env"</span>,</span>
<span>  abun <span class="op">=</span> <span class="st">"abun.calib"</span>,</span>
<span>  p_val <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'obscor'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/identify.html" class="external-link">identify</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">labels</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'obscor'</span></span>
<span><span class="fu">autoplot</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  which <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  variable_names <span class="op">=</span> <span class="st">"env"</span>,</span>
<span>  abun <span class="op">=</span> <span class="st">"abun.calib"</span>,</span>
<span>  p_val <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  nbins <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  top <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-spp">spp<a class="anchor" aria-label="anchor" href="#arg-spp"></a></dt>
<dd><p>Data frame of modern training set species data, transformed if
required, for example with <code>sqrt</code></p></dd>


<dt id="arg-env">env<a class="anchor" aria-label="anchor" href="#arg-env"></a></dt>
<dd><p>Vector of a single environmental variable</p></dd>


<dt id="arg-fos">fos<a class="anchor" aria-label="anchor" href="#arg-fos"></a></dt>
<dd><p>Data frame of fossil species data. Species codes and
transformations should match those in spp.</p></dd>


<dt id="arg-ord">ord<a class="anchor" aria-label="anchor" href="#arg-ord"></a></dt>
<dd><p>Constrained ordination method to use.
<code><a href="https://rdrr.io/pkg/vegan/man/cca.html" class="external-link">rda</a></code> is the default,
<code><a href="https://rdrr.io/pkg/vegan/man/cca.html" class="external-link">cca</a></code> should also work.
<code><a href="https://rdrr.io/pkg/vegan/man/dbrda.html" class="external-link">capscale</a></code> won't work without modifications to the code
(or a wrapper).</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>number of random training sets. More is better.</p></dd>


<dt id="arg-min-occur">min.occur<a class="anchor" aria-label="anchor" href="#arg-min-occur"></a></dt>
<dd><p>Minimum number of occurrences of species in the species and
fossil data.</p></dd>


<dt id="arg-autosim">autosim<a class="anchor" aria-label="anchor" href="#arg-autosim"></a></dt>
<dd><p>Optional data frame of random values. This is useful if the
training set is spatially autocorrelated and the supplied data frame contains
autocorrelated random variables.
If <code>autosim</code> is missing, and <code>permute</code> is <code>FALSE</code>, the
transfer functions are trained on random variables drawn from a uniform
distribution.</p></dd>


<dt id="arg-permute">permute<a class="anchor" aria-label="anchor" href="#arg-permute"></a></dt>
<dd><p>logical value. Generate random environmental variables by
permuting existing variable.
Only possible if there is only one environmental variable and <code>autosim</code>
is missing.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>An obscor object.</p></dd>


<dt id="arg-xlab">xlab<a class="anchor" aria-label="anchor" href="#arg-xlab"></a></dt>
<dd><p>X-axis label if the default is unsatisfactory.</p></dd>


<dt id="arg-ylab">ylab<a class="anchor" aria-label="anchor" href="#arg-ylab"></a></dt>
<dd><p>Y-axis label if the default is unsatisfactory.</p></dd>


<dt id="arg-f">f<a class="anchor" aria-label="anchor" href="#arg-f"></a></dt>
<dd><p>Scale factor for the abundances, the maximum cex of points for the
which=1 plot.</p></dd>


<dt id="arg-which">which<a class="anchor" aria-label="anchor" href="#arg-which"></a></dt>
<dd><p>Which type of plot. which = 1 gives a plot of RDA scores against
species optima. which = 2 gives a histogram showing the null distribution of
correlations between RDA scores and species optima, together with the
observed correlation.</p></dd>


<dt id="arg-variable-names">variable_names<a class="anchor" aria-label="anchor" href="#arg-variable-names"></a></dt>
<dd><p>Name of environmental variable (only 1 currently) for
the label on the observed correlation with which = 2</p></dd>


<dt id="arg-abun">abun<a class="anchor" aria-label="anchor" href="#arg-abun"></a></dt>
<dd><p>Which species weighting required for plots. See details</p></dd>


<dt id="arg-p-val">p_val<a class="anchor" aria-label="anchor" href="#arg-p-val"></a></dt>
<dd><p>P value to draw a line vertical line at (with which=2)</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other arguments to plot or identify</p></dd>


<dt id="arg-labels">labels<a class="anchor" aria-label="anchor" href="#arg-labels"></a></dt>
<dd><p>Labels for the points in identify. By default, the species
names from intersection of colnames(spp) and colnames(fos) are used.</p></dd>


<dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>An obscor object.</p></dd>


<dt id="arg-nbins">nbins<a class="anchor" aria-label="anchor" href="#arg-nbins"></a></dt>
<dd><p>integer giving number of bins for the histogram</p></dd>


<dt id="arg-top">top<a class="anchor" aria-label="anchor" href="#arg-top"></a></dt>
<dd><p>Proportion of the figure below the environmental name labels.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>obs.cor returns an obscor object, which is a list</p>
<dl><dt>ob</dt>
<dd><p>Observed correlation. Data.frame with columns Optima, RDA1 and
abun containing the species optima, ordination axis 1 scores, and
abundance used to weight the species respectively and a vector containing
the weighted and unweighted correlations between species optima and
ordination scores.</p></dd>

<dt>sim</dt>
<dd><p>Matrix with the correlation between species weighted average
optima and ordination scores in the first column and the weighted
correlation in the second column. Each row represents a different random
environmental variable.</p></dd>

<dt>sigs</dt>
<dd><p>p-value for the observed correlation between species weighted
average optima and ordination scores for each of the weights.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Obs.cor calculates the (weighted) correlation between the species
WA optima in the calibration set and their ordination axis one scores in the
fossil data. Seven different weights for the species are implemented.</p><ul><li><p>"abun.fos" - weight by the mean abundance in the fossil data.</p></li>
<li><p>"abun.calib" - weight by the mean abundance in the calibration data</p></li>
<li><p>"abun.joint" - weight by the product of the mean abundance in the
fossil and calibration data</p></li>
<li><p>"n2.fos" - weight by the effective number of occurrences
(Hill's N2) of each species in the fossil data</p></li>
<li><p>"n2.calib" - weight by the effective number of occurrences
(Hill's N2) of each species in the calibration data</p></li>
<li><p>"n2.joint" - weight by the product of n2.calib and n2.fos</p></li>
<li><p>"unweighted" - all species receive same weight.
This is unlikely to be the best option but is included for completeness.</p></li>
</ul><p>It is unclear which of these weights is likely to be best:
research is in progress.
A square root transformation of the species data is often useful.
<code>n = 99</code> is too small in practice to give a smooth
histogram of the null model. <code>n = 999</code> is better.</p>
    </div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>

<ul><li><p><code>plot(obscor)</code>: Plots for obscor object</p></li>
<li><p><code>identify(obscor)</code>: Identify species on obs.cor plot</p></li>
<li><p><code>autoplot(obscor)</code>: autoplot for obscor object</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The test of the weighted correlation between species optima and
ordination axis scores is more powerful, especially with a small number of
fossil observations, that the test of variance explained in
<code><a href="randomTF.html">randomTF</a></code> but is only applicable to WA and will have a large
type II error if there are few species.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Telford, R. J. and Birks, H. J. B. (2011) A novel method for
assessing the statistical significance of quantitative reconstructions
inferred from biotic assemblages. <em>Quaternary Science Reviews</em>
<b>30</b>: 1272–1278.
<a href="https://doi.org/10.1016/j.quascirev.2011.03.002" class="external-link">doi:10.1016/j.quascirev.2011.03.002</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="randomTF.html">randomTF</a></code>, <code><a href="https://rdrr.io/pkg/rioja/man/WA.html" class="external-link">WA</a></code>,
<code><a href="https://rdrr.io/pkg/vegan/man/cca.html" class="external-link">rda</a></code>, <code><a href="https://rdrr.io/pkg/vegan/man/cca.html" class="external-link">cca</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Richard Telford <a href="mailto:richard.telford@uib.no">richard.telford@uib.no</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://www.staff.ncl.ac.uk/stephen.juggins/" class="external-link">rioja</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">SWAP</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">RLGH</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rlgh.obs</span> <span class="op">&lt;-</span> <span class="fu">obs.cor</span><span class="op">(</span></span></span>
<span class="r-in"><span>  spp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">SWAP</span><span class="op">$</span><span class="va">spec</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  env <span class="op">=</span> <span class="va">SWAP</span><span class="op">$</span><span class="va">pH</span>,</span></span>
<span class="r-in"><span>  fos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">RLGH</span><span class="op">$</span><span class="va">spec</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  n <span class="op">=</span> <span class="fl">49</span> <span class="co"># low number for speed</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rlgh.obs</span><span class="op">$</span><span class="va">sig</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   abun.fos abun.calib abun.joint     n2.fos   n2.calib   n2.joint unweighted </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       0.02       0.02       0.02       0.02       0.02       0.02       1.00 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rlgh.obs</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="obs.cor-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rlgh.obs</span>, which <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="obs.cor-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: ggplot2</span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">rlgh.obs</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="obs.cor-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">rlgh.obs</span>, which <span class="op">=</span> <span class="fl">2</span>, variable_names <span class="op">=</span> <span class="st">"pH"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="obs.cor-4.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Richard Telford.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

